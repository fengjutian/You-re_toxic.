# 关系风险评估小程序

## 项目概述

这是一款基于微信小程序开发的非诊断性心理测评工具，旨在帮助用户理解关系中的行为模式与可能影响。通过两个核心评估模块，用户可以获得关于关系风险的客观分析和个性化保护建议。

## 核心功能

1. **他人行为风险评估**：评估关系中对方行为的潜在风险维度
2. **自我消耗风险评估**：评估关系对自身心理状态的影响程度
3. **智能风险分析**：基于评估数据生成综合风险分析报告
4. **个性化保护建议**：根据分析结果提供针对性的关系保护策略

## 技术架构

- **开发框架**：微信小程序原生开发（WXML, WXSS, JavaScript）
- **数据存储**：微信小程序全局数据管理
- **UI设计**：绿色主题线性渐变背景，现代化卡片式布局

## 主要文件结构

```
├── pages/
│   ├── index/          # 首页：评估入口
│   ├── forward/        # 他人行为风险评估页面
│   ├── reverse/        # 自我消耗风险评估页面
│   ├── result/         # 风险分析结果页面
│   └── tips/           # 保护建议页面
├── app.js              # 小程序入口文件
├── app.json            # 小程序配置文件
└── README.md           # 项目说明文档
```

## 核心算法实现（result.js）

### 算法概述

位于 `pages/result/result.js` 的核心算法负责整合两个评估模块的数据，计算风险维度，并生成综合分析结果。算法主要分为五个部分：

### 1. 维度名称映射

将技术维度键名映射为用户友好的中文名称：

```javascript
const dimNames = {
  'control': '控制行为',
  'devalue': '情感贬低',
  'selfish': '自我中心',
  'emotional': '情绪依赖',
  'manipulation': '操纵行为',
  'distrust': '不信任',
  'emotional_drain': '情绪消耗',
  'self_doubt': '自我怀疑',
  'boundary_erosion': '边界侵蚀',
  'guilt_pressure': '内疚施压',
  'avoidance': '回避沟通',
  'imbalance': '付出失衡'
}
```

### 2. TIRS（他人行为风险评估）分析

**功能**：计算每个维度的加权平均分，识别高风险维度

**算法逻辑**：
1. 遍历所有TIRS维度
2. 计算每个维度所有问题答案的平均值
3. 如果平均值 >= 2（即"经常"或更严重），则标记为高风险维度
4. 收集所有高风险维度的用户友好名称

**关键代码**：
```javascript
Object.keys(tirs).forEach(dim => {
  const arr = tirs[dim] || [];
  if (arr.length === 0) return;
  
  const avg = arr.reduce((a,b)=>a+b,0)/arr.length;
  
  if (avg >= 2) {
    const dimName = dimNames[dim] || dim;
    tirsHigh.push(dimName);
  }
});
```

### 3. RTDRS（自我消耗风险评估）分析

**功能**：找出自我消耗程度最高的维度

**算法逻辑**：
1. 遍历所有RTDRS维度
2. 找出每个维度的最高分数（最严重的情况）
3. 比较所有维度的最高分数，确定最严重的维度

**关键代码**：
```javascript
let rtdrsTop = '';
let maxVal = -1;

Object.keys(rtdrs).forEach(dim=>{
  const arr = rtdrs[dim] || [];
  if (arr.length === 0) return;
  
  const val = Math.max(...arr);
  if(val > maxVal){
    maxVal = val;
    rtdrsTop = dimNames[dim] || dim;
  }
});
```

### 4. 关系整体状态评估

**功能**：根据TIRS和RTDRS的分析结果，综合判断关系的整体风险状态

**评估规则**（优先级从高到低）：
1. **高风险消耗型关系**：≥2个高风险他人行为维度 AND 自我消耗程度≥2
2. **内在压力/边界议题**：0个高风险他人行为维度 AND 自我消耗程度≥2
3. **潜在风险信号**：≥1个高风险他人行为维度 AND 自我消耗程度≤1
4. **低风险**：不符合上述任何情况

**关键代码**：
```javascript
let status = '暂无明显结构性风险';

if(tirsHigh.length >= 2 && maxVal >= 2){
  status = '呈现出高风险的消耗型关系特征';
}else if(tirsHigh.length === 0 && maxVal >= 2){
  status = '关系中可能存在内在压力或边界议题';
}else if(tirsHigh.length >= 1 && maxVal <= 1){
  status = '关系中存在潜在风险信号';
}
```

### 5. 结果整合与存储

**功能**：整合所有分析结果，存储到全局数据，并更新页面显示

**关键代码**：
```javascript
const analysis = {
  status: status,                 // 关系整体状态
  tirsHigh: safeTirsHigh,        // 高风险他人行为维度
  rtdrsTop: rtdrsTop             // 最严重的自我消耗体验
};

app.globalData.analysis = analysis;
this.setData({ analysis });
```

## 数据流程

1. **数据输入**：用户在评估页面选择答案，数据存储在全局数组中
2. **数据处理**：result.js算法处理原始答案，计算风险指标
3. **结果输出**：生成综合分析结果，展示在结果页面
4. **建议生成**：基于分析结果，tips页面展示个性化保护建议

## 安装与运行

1. 克隆或下载项目到本地
2. 使用微信开发者工具打开项目
3. 在开发者工具中编译并预览
4. 或通过微信扫码在手机上体验

## 使用说明

1. 进入小程序首页，点击任意评估开始
2. 依次完成所有评估问题（每个问题必须选择一个答案）
3. 完成评估后自动跳转到结果页面查看分析
4. 点击"查看保护建议"获取个性化建议
5. 可随时返回首页重新开始评估或清除已有数据

## 技术特点

- **响应式设计**：适配不同屏幕尺寸的微信设备
- **用户友好**：清晰的视觉反馈和操作指引
- **数据安全**：所有数据仅存储在本地，保护用户隐私
- **算法严谨**：基于科学的心理评估原理设计分析逻辑

## 注意事项

- 本工具为非诊断性心理测评，仅用于自我认知和参考
- 评估结果不构成专业心理咨询或诊断建议
- 如遇严重心理困扰，请及时寻求专业心理帮助

---

**项目版本**：1.0.0
**开发环境**：微信开发者工具
**技术栈**：微信小程序原生开发
